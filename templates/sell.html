<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sell an Item - SecondLife</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='header.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='footer.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='sell.css') }}">
</head>
<body>
  <div class="main-container">
    <!-- Include header -->
    {% include 'header.html' %}
    
    <!-- Sell page content -->
    <main class="sell-page">
      <div class="sell-header">
        <h1 class="page-title">Sell Your Electronics</h1>
        <p class="page-subtitle">List your pre-owned electronics and give them a second life</p>
      </div>
      
      <!-- Sell page container -->
      <div class="sell-container">
        <!-- Progress steps -->
        <div class="progress-steps">
          <div class="progress-step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-label">Item Details</div>
          </div>
          <div class="progress-connector"></div>
          <div class="progress-step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-label">Photos</div>
          </div>
          <div class="progress-connector"></div>
          <div class="progress-step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-label">Pricing</div>
          </div>
          <div class="progress-connector"></div>
          <div class="progress-step" data-step="4">
            <div class="step-number">4</div>
            <div class="step-label">Review</div>
          </div>
        </div>
        
        <!-- Form container -->
        <div class="form-container">
          <form id="sell-form" action="{{ url_for('submit_listing') }}" method="POST" enctype="multipart/form-data">
            <!-- Step 1: Item Details -->
            <div class="form-step" data-step="1">
              <h2 class="form-section-title">Item Details</h2>
              
              <div class="form-group">
                <label for="category">Category <span class="required">*</span></label>
                <select id="category" name="category" required>
                  <option value="">Select a category</option>
                  <option value="smartphones">Smartphones</option>
                  <option value="laptops">Laptops</option>
                  <option value="tablets">Tablets</option>
                  <option value="cameras">Cameras</option>
                  <option value="audio">Audio</option>
                  <option value="accessories">Accessories</option>
                  <option value="other">Other</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="title">Item Title <span class="required">*</span></label>
                <input type="text" id="title" name="title" placeholder="e.g. iPhone 12 Pro Max 256GB Space Gray" required>
                <span class="form-hint">Be specific about brand, model, and specifications</span>
              </div>
              
              <div class="form-group">
                <label for="brand">Brand <span class="required">*</span></label>
                <input type="text" id="brand" name="brand" placeholder="e.g. Apple, Samsung, Sony" required>
              </div>
              
              <div class="form-row">
                <div class="form-group half">
                  <label for="model">Model <span class="required">*</span></label>
                  <input type="text" id="model" name="model" placeholder="e.g. iPhone 12 Pro Max" required>
                </div>
                <div class="form-group half">
                  <label for="year">Year <span class="required">*</span></label>
                  <input type="number" id="year" name="year" placeholder="e.g. 2022" min="1990" max="2030" required>
                </div>
              </div>
              
              <div class="form-group">
                <label for="condition">Condition <span class="required">*</span></label>
                <select id="condition" name="condition" required>
                  <option value="">Select condition</option>
                  <option value="like_new">Like New - Looks new and works perfectly</option>
                  <option value="excellent">Excellent - Minor wear, works perfectly</option>
                  <option value="good">Good - Noticeable wear, works well</option>
                  <option value="fair">Fair - Heavy wear, fully functional</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="description">Description <span class="required">*</span></label>
                <textarea id="description" name="description" rows="5" placeholder="Describe your item in detail including specs, condition, and any accessories included." required></textarea>
                <span class="form-hint">Minimum 50 characters</span>
              </div>
              
              <div class="form-group">
                <label>What's included? <span class="required">*</span></label>
                <div class="checkbox-group">
                  <label class="checkbox-label">
                    <input type="checkbox" name="included_items" value="original_box"> Original Box
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" name="included_items" value="charger"> Charger/Power Adapter
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" name="included_items" value="cable"> Cable(s)
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" name="included_items" value="manual"> Manual
                  </label>
                  <label class="checkbox-label">
                    <input type="checkbox" name="included_items" value="accessories"> Other Accessories
                  </label>
                </div>
              </div>
              
              <div class="form-buttons">
                <button type="button" class="next-button">Next: Add Photos <i class="fas fa-arrow-right"></i></button>
              </div>
            </div>
            
            <!-- Step 2: Photos -->
            <div class="form-step" data-step="2" style="display: none;">
              <h2 class="form-section-title">Upload Photos</h2>
              <p class="form-section-subtitle">Clear photos increase your chances of selling faster. Add at least 3 photos.</p>
              
              <div class="photo-upload-container">
                <div class="photo-guidelines">
                  <h3>Photo Guidelines:</h3>
                  <ul>
                    <li>Take photos in good lighting</li>
                    <li>Show any damage or imperfections</li>
                    <li>Include photos of all accessories</li>
                    <li>Add photos from multiple angles</li>
                  </ul>
                </div>
                
                <div class="photo-upload-area">
                  <div class="main-photo-upload">
                    <label for="main-photo" class="photo-upload-label">
                      <div class="upload-icon">
                        <i class="fas fa-camera"></i>
                      </div>
                      <span>Main Photo</span>
                      <span class="upload-hint">(Click to upload)</span>
                    </label>
                    <input type="file" id="main-photo" name="main_photo" accept="image/*" required class="photo-input">
                    <div class="photo-preview" id="main-photo-preview"></div>
                  </div>
                  
                  <div class="additional-photos">
                    <div class="photo-upload-box">
                      <label for="photo-1" class="photo-upload-label">
                        <div class="upload-icon">
                          <i class="fas fa-plus"></i>
                        </div>
                        <span class="upload-hint">(Click to upload)</span>
                      </label>
                      <input type="file" id="photo-1" name="additional_photos" accept="image/*" class="photo-input">
                      <div class="photo-preview" id="photo-1-preview"></div>
                    </div>
                    
                    <div class="photo-upload-box">
                      <label for="photo-2" class="photo-upload-label">
                        <div class="upload-icon">
                          <i class="fas fa-plus"></i>
                        </div>
                        <span class="upload-hint">(Click to upload)</span>
                      </label>
                      <input type="file" id="photo-2" name="additional_photos" accept="image/*" class="photo-input">
                      <div class="photo-preview" id="photo-2-preview"></div>
                    </div>
                    
                    <div class="photo-upload-box">
                      <label for="photo-3" class="photo-upload-label">
                        <div class="upload-icon">
                          <i class="fas fa-plus"></i>
                        </div>
                        <span class="upload-hint">(Click to upload)</span>
                      </label>
                      <input type="file" id="photo-3" name="additional_photos" accept="image/*" class="photo-input">
                      <div class="photo-preview" id="photo-3-preview"></div>
                    </div>
                    
                    <div class="photo-upload-box">
                      <label for="photo-4" class="photo-upload-label">
                        <div class="upload-icon">
                          <i class="fas fa-plus"></i>
                        </div>
                        <span class="upload-hint">(Click to upload)</span>
                      </label>
                      <input type="file" id="photo-4" name="additional_photos" accept="image/*" class="photo-input">
                      <div class="photo-preview" id="photo-4-preview"></div>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="form-buttons">
                <button type="button" class="prev-button"><i class="fas fa-arrow-left"></i> Back</button>
                <button type="button" class="next-button">Next: Pricing <i class="fas fa-arrow-right"></i></button>
              </div>
            </div>
            
            <!-- Step 3: Pricing -->
            <div class="form-step" data-step="3" style="display: none;">
              <h2 class="form-section-title">Set Your Price</h2>
              
              <div class="pricing-guidance">
                <div class="suggested-price">
                  <h3>Suggested Price Range</h3>
                  <p>Based on similar items sold recently:</p>
                  <div class="price-range">
                    <span>$150 - $320</span>
                  </div>
                  <p class="price-note">This is an estimate. You can set any price you want.</p>
                </div>
              </div>
              
              <div class="form-group">
                <label for="price">Your Price <span class="required">*</span></label>
                <div class="price-input">
                  <span class="currency-symbol">$</span>
                  <input type="number" id="price" name="price" placeholder="0.00" min="1" step="0.01" required>
                </div>
              </div>
              
              <div class="form-group">
                <label for="original-price">Original Price (when new)</label>
                <div class="price-input">
                  <span class="currency-symbol">$</span>
                  <input type="number" id="original-price" name="original_price" placeholder="0.00" min="1" step="0.01">
                </div>
                <span class="form-hint">Showing the original price can help sell your item faster</span>
              </div>
              
              <div class="form-group">
                <label>Price Negotiable?</label>
                <div class="radio-group">
                  <label class="radio-label">
                    <input type="radio" name="negotiable" value="yes" checked> Yes
                  </label>
                  <label class="radio-label">
                    <input type="radio" name="negotiable" value="no"> No
                  </label>
                </div>
              </div>
              
              <div class="form-group">
                <label for="shipping-method">Shipping Method <span class="required">*</span></label>
                <select id="shipping-method" name="shipping_method" required>
                  <option value="">Select shipping method</option>
                  <option value="local_pickup">Local Pickup Only</option>
                  <option value="ship_domestic">Ship Domestically</option>
                  <option value="ship_international">Ship Internationally</option>
                </select>
              </div>
              
              <div class="form-group shipping-cost" style="display: none;">
                <label for="shipping-cost">Shipping Cost</label>
                <div class="price-input">
                  <span class="currency-symbol">$</span>
                  <input type="number" id="shipping-cost" name="shipping_cost" placeholder="0.00" min="0" step="0.01">
                </div>
                <div class="radio-group shipping-paid-by">
                  <label class="radio-label">
                    <input type="radio" name="shipping_paid_by" value="buyer" checked> Paid by buyer
                  </label>
                  <label class="radio-label">
                    <input type="radio" name="shipping_paid_by" value="seller"> Free shipping (you pay)
                  </label>
                </div>
              </div>
              
              <div class="form-buttons">
                <button type="button" class="prev-button"><i class="fas fa-arrow-left"></i> Back</button>
                <button type="button" class="next-button">Next: Review <i class="fas fa-arrow-right"></i></button>
              </div>
            </div>
            
            <!-- Step 4: Review -->
            <div class="form-step" data-step="4" style="display: none;">
              <h2 class="form-section-title">Review Your Listing</h2>
              
              <div class="review-notice">
                <i class="fas fa-info-circle"></i>
                <p>Your listing will be reviewed by our team before it appears on the marketplace. This typically takes 24-48 hours.</p>
              </div>
              
              <div class="listing-preview">
                <h3>Listing Preview</h3>
                
                <div class="preview-section">
                  <div class="preview-item">
                    <div class="preview-label">Category:</div>
                    <div class="preview-value" id="preview-category"></div>
                  </div>
                  
                  <div class="preview-item">
                    <div class="preview-label">Title:</div>
                    <div class="preview-value" id="preview-title"></div>
                  </div>
                  
                  <div class="preview-item">
                    <div class="preview-label">Brand & Model:</div>
                    <div class="preview-value" id="preview-brand-model"></div>
                  </div>
                  
                  <div class="preview-item">
                    <div class="preview-label">Condition:</div>
                    <div class="preview-value" id="preview-condition"></div>
                  </div>
                  
                  <div class="preview-item">
                    <div class="preview-label">Price:</div>
                    <div class="preview-value" id="preview-price"></div>
                  </div>
                  
                  <div class="preview-item">
                    <div class="preview-label">Shipping:</div>
                    <div class="preview-value" id="preview-shipping"></div>
                  </div>
                </div>
                
                <div class="preview-photos">
                  <div class="preview-main-photo" id="preview-main-photo"></div>
                  <div class="preview-additional-photos" id="preview-additional-photos"></div>
                </div>
                
                <div class="preview-description">
                  <h4>Description:</h4>
                  <p id="preview-description-text"></p>
                </div>
              </div>
              
              <div class="form-group terms-agreement">
                <label class="checkbox-label">
                  <input type="checkbox" name="terms_agreement" required>
                  I agree to the <a href="/terms" target="_blank">Terms and Conditions</a> and confirm that all information provided is accurate.
                </label>
              </div>
              
              <div class="form-buttons">
                <button type="button" class="prev-button"><i class="fas fa-arrow-left"></i> Back</button>
                <button type="submit" class="submit-button">Submit Listing <i class="fas fa-check"></i></button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </main>
    
    <!-- Include footer -->
    {% include 'footer.html' %}
  </div>
  
  <!-- Submission success modal -->
  <div class="success-modal" id="success-modal">
    <div class="modal-content">
      <div class="modal-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2>Listing Submitted!</h2>
      <p>Your item has been submitted for review.</p>
      <p>We'll notify you once it's approved and live on our marketplace.</p>
      <div class="modal-buttons">
        <a href="{{ url_for('account_listings') }}" class="modal-button primary">View My Listings</a>
        <a href="{{ url_for('sell') }}" class="modal-button secondary">Sell Another Item</a>
      </div>
    </div>
  </div>
  
  <!-- JavaScript for form functionality-->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Variables
      const form = document.getElementById('sell-form');
      const steps = document.querySelectorAll('.form-step');
      const progressSteps = document.querySelectorAll('.progress-step');
      const nextButtons = document.querySelectorAll('.next-button');
      const prevButtons = document.querySelectorAll('.prev-button');
      const shippingMethod = document.getElementById('shipping-method');
      const shippingCostGroup = document.querySelector('.shipping-cost');
      const successModal = document.getElementById('success-modal');
      let currentStep = 1;
      
      // Handle photo uploads and previews
      const photoInputs = document.querySelectorAll('.photo-input');
      photoInputs.forEach(input => {
        input.addEventListener('change', function() {
          const previewId = this.id + '-preview';
          const preview = document.getElementById(previewId);
          
          if (this.files && this.files[0]) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
              preview.innerHTML = `
                <div class="preview-image-container">
                  <img src="${e.target.result}" alt="Preview" class="preview-image">
                  <button type="button" class="remove-photo">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
              `;
              
              // Remove photo functionality
              const removeButton = preview.querySelector('.remove-photo');
              removeButton.addEventListener('click', function(e) {
                e.preventDefault();
                input.value = '';
                preview.innerHTML = '';
              });
            };
            
            reader.readAsDataURL(this.files[0]);
          }
        });
      });
      
      // Show/hide shipping cost based on shipping method
      if (shippingMethod) {
        shippingMethod.addEventListener('change', function() {
          if (this.value === 'ship_domestic' || this.value === 'ship_international') {
            shippingCostGroup.style.display = 'block';
          } else {
            shippingCostGroup.style.display = 'none';
          }
        });
      }
      
      // Navigation between steps
      function goToStep(step) {
        // Hide all steps
        steps.forEach(s => {
          s.style.display = 'none';
        });
        
        // Show current step
        const currentStepElem = document.querySelector(`.form-step[data-step="${step}"]`);
        if (currentStepElem) {
          currentStepElem.style.display = 'block';
        }
        
        // Update progress steps
        progressSteps.forEach(s => {
          const stepNum = parseInt(s.getAttribute('data-step'));
          if (stepNum < step) {
            s.classList.add('completed');
            s.classList.remove('active');
          } else if (stepNum === step) {
            s.classList.add('active');
            s.classList.remove('completed');
          } else {
            s.classList.remove('active', 'completed');
          }
        });
        
        // Scroll to top of form
        window.scrollTo({
          top: form.offsetTop - 100,
          behavior: 'smooth'
        });
      }
      
      // Next button click
      nextButtons.forEach(button => {
        button.addEventListener('click', function() {
          // Validate current step fields
          const currentStepElem = document.querySelector(`.form-step[data-step="${currentStep}"]`);
          const requiredFields = currentStepElem.querySelectorAll('[required]');
          let valid = true;
          
          requiredFields.forEach(field => {
            if (!field.value) {
              valid = false;
              field.classList.add('invalid');
            } else {
              field.classList.remove('invalid');
            }
          });
          
          if (valid) {
            // If moving to review step, update preview
            if (currentStep === 3) {
              updatePreview();
            }
            
            currentStep++;
            goToStep(currentStep);
          } else {
            alert('Please fill in all required fields.');
          }
        });
      });
      
      // Previous button click
      prevButtons.forEach(button => {
        button.addEventListener('click', function() {
          currentStep--;
          goToStep(currentStep);
        });
      });
      
      // Update preview in review step
      function updatePreview() {
        document.getElementById('preview-category').textContent = document.getElementById('category').options[document.getElementById('category').selectedIndex].text;
        document.getElementById('preview-title').textContent = document.getElementById('title').value;
        document.getElementById('preview-brand-model').textContent = `${document.getElementById('brand').value} ${document.getElementById('model').value} (${document.getElementById('year').value})`;
        document.getElementById('preview-condition').textContent = document.getElementById('condition').options[document.getElementById('condition').selectedIndex].text;
        document.getElementById('preview-price').textContent = `$${document.getElementById('price').value}`;
        document.getElementById('preview-shipping').textContent = document.getElementById('shipping-method').options[document.getElementById('shipping-method').selectedIndex].text;
        document.getElementById('preview-description-text').textContent = document.getElementById('description').value;
        
        // Show main photo in preview
        const mainPhotoPreview = document.getElementById('main-photo-preview');
        if (mainPhotoPreview.querySelector('.preview-image')) {
          const imgSrc = mainPhotoPreview.querySelector('.preview-image').src;
          document.getElementById('preview-main-photo').innerHTML = `<img src="${imgSrc}" alt="Main Photo">`;
        }
        
        // Show additional photos in preview
        const additionalPhotoContainer = document.getElementById('preview-additional-photos');
        additionalPhotoContainer.innerHTML = '';
        const additionalPhotoPreviews = document.querySelectorAll('.additional-photos .preview-image');
        additionalPhotoPreviews.forEach(img => {
          if (img) {
            additionalPhotoContainer.innerHTML += `<div class="preview-photo-thumbnail"><img src="${img.src}" alt="Additional Photo"></div>`;
          }
        });
      }
      
      // Form submission
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Here you would typically use fetch or XMLHttpRequest to submit the form data
        // For demonstration, we'll just show the success modal
        
        // Show success modal
        successModal.style.display = 'flex';
        
        // In a real implementation, you would submit the form and show the modal on success
        /*
        fetch(form.action, {
          method: form.method,
          body: new FormData(form)
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            successModal.style.display = 'flex';
          } else {
            alert(data.message || 'Error submitting form. Please try again.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('An error occurred. Please try again.');
        });
        */
      });
      
      // Close modal when clicking outside
      window.addEventListener('click', function(event) {
        if (event.target === successModal) {
          successModal.style.display = 'none';
        }
      });
    });

  </script>
</body>
</html>